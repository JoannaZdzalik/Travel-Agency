//Który cel podró¿y zosta³ wybrany przez najwiêcej osób w danym roku - dopuszcza kilka rekordów
select max(name) as name, count(name)as occurences  from destinations 
inner join trips on trips.id_destination=destinations.id
inner join reservations on reservations.id_trip=trips.id
where to_char(departure_date, 'YYYY-MM-DD') LIKE '2021%'
group by name;


//Który klient nie zamówi³ wycieczki w danym roku.
SELECT name, surname from clients except
SELECT name, surname from clients
where id = any 
(SELECT id_client from reservations
left join trips on reservations.id_trip = trips.id
where to_char(departure_date, 'YYYY-MM-DD') LIKE '2019%')


//Œredni¹ cenê oraz sumê ca³kowit¹, za któr¹ sprzedano dan¹ wycieczkê.
//dla wszystkich wycieczek
select id_trip, sum(actual_price), avg(actual_price) from reservations
group by id_trip  
//dla konkretnej wycieczki
select sum(actual_price), avg(actual_price) from reservations
where id_trip=1;


//Który przewodnik wygenerowa³ najwiêkszy przychód, czyli kierowa³ wycieczki za najwiêksz¹ sumê w danym roku.
select name from guides
left join trips on guides.id=trips.id_guide
left join reservations on reservations.id_trip=trips.id
group by name
order by sum(actual_price) desc limit 1



//Który klient dosta³ najwiêkszy rabat (ró¿nica w cenie sugerowanej i transakcyjnej)
select max(surname) as surname from clients 
left join reservations on clients.id=reservations.id_client
left join trips on trips.id=reservations.id_trip
group by surname
order by sum(suggested_price-actual_price) desc limit 1;
